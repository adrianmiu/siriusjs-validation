!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).SiriusValidation=e()}(this,(function(){"use strict";var t={_default:"Field is not valid",required:"This field is required",required_with:"This field is required",required_without:"This field is required",email:"This field is not a valid email",url:"This field is not a valid web address (must start with http:// or https://)",contains:'This field should contain "{target}"',starts_with:'This field should start with "{target}"',ends_with:'This field should end with "{target}"',equal:"This field should be equal to {target}",min:"This field should be greater or equal to {min}",max:"This field should be smaller or equal to {max}",alpha:"This field should contain only letters",alpha_num:"This field should contain only letters and numbers",slug:'This field should contain only letters, numbers, "-" or "_"',regex:"This field does not match the pattern",greater_than:"This field should be greater or equal to {min}",less_than:"This field should be smaller or equal to {max}",array_min_length:"This list should contain at least {min} items",array_max_length:"This list should contain less than {max} items",min_length:"This field should have at least {min} characters",max_length:"This field should have less than {max} characters",in_list:"This field should be selected from the list of accepted values",not_in_list:"This field has a value that is blacklisted"};function e(t,e){if(-1===e.indexOf("*"))return e;let n=t.replace(/\]/g,"").split("[");return e.replace(/\]/g,"").split("[").map((function(t,e){return"*"===t?n[e]:t})).reduce((function(t,e,n){return t+=0===n?e:"["+e+"]"}),"")}function n(t,e,r){let i=e.indexOf("["),s=e.indexOf("]");if(-1===i)return t&&t[e]||r;let a=e.substring(0,i),l=e.substring(i+1,s)+e.substring(s+1);return n(t[a],l,r)}function r(t,r,i){return t&&r&&i.substring&&"@"===i.substring(0,1)?n(t,e(r,i.substring(1))):i}function i(t,e){return Object.keys(t).forEach((function(n){return e(n,t[n])}))}function s(e,n,s,a,l){l=l||t;let u=e.$rules[s][a].params||{};i(u,(function(t,i){r(e.data,n,i)}));let o=[n+":"+a,s+":"+a,a].find((function(t){return l[t]})),h=!!o&&l[o];return"function"==typeof h?h(e,n,s):h?(i(u,(function(t,i){h=h.replace(new RegExp("{"+t+"}","g"),r(e.getData(),n,i))})),h):l._default||"Field is not valid"}var a=function(t,e){return function(){let n=Array.prototype.slice.call(arguments),r={},i=[];return e?(r=e.reduce((function(t,e,r){return t[e]=n[r],t}),{}),i=e.reduce((function(t,e,r){let i=n[r];return("string"==typeof i||i instanceof String)&&"@"===i.substring(0,1)&&t.push(i.substring(1)),t}),[])):r=n,{refs:i,params:r,validate:t}}};function l(t){return Array.isArray(t)?t.length>0:!1===t||0===t||!!t}var u=a((function(t){return l(t)})),o=a((function(t,e,n){return!r(n,e,this.params.target)||l(t)}),["target"]),h=a((function(t,e,n){return!!r(n,e,this.params.target)||l(t)}),["target"]),f=a((function(t,e,n){return t==r(n,e,this.params.target)}),["target"]),c=a((function(t,e,n){return!l(t)||+t>=+r(n,e,this.params.min)}),["min"]),d=a((function(t,e,n){return!l(t)||+t<=r(n,e,this.params.max)}),["max"]),g=a((function(t,e,n){return!l(t)||t.length&&t.length>=r(n,e,this.params.min)}),["min"]),m=a((function(t,e,n){return!l(t)||t.length&&t.length<=r(n,e,this.params.max)}),["max"]),p=a((function(t){return!l(t)||/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.toLowerCase())})),b=a((function(t){return!l(t)||/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/.test(t.toLowerCase())})),y={required:u,required_with:o,required_without:h,equal:f,greater_than:c,lower_than:d,min:c,max:d,min_length:g,max_length:m,contains:a((function(t){return!l(t)||-1!==t.indexOf(this.params.target)}),["target"]),starts_with:a((function(t){return!l(t)||t.substring(0,this.params.target.length)===this.params.target}),["target"]),ends_with:a((function(t){return!l(t)||t.substring(t.length-this.params.target.length)===this.params.target}),["target"]),email:p,url:b,in_list:a((function(t){return!l(t)||-1!==this.params.target.indexOf(t)}),["target"]),not_in_list:a((function(t){return!l(t)||-1===this.params.target.indexOf(t)}),["target"]),alpha:a((function(t){return!l(t)||/^[a-zA-Z]*$/.test(t)})),alpha_num:a((function(t){return!l(t)||/^[a-zA-Z0-9]*$/.test(t)})),slug:a((function(t){return!l(t)||/^[a-zA-Z0-9_-]*$/.test(t)})),regex:a((function(t){return!l(t)||new RegExp(this.params.pattern,this.params.modifiers||"").test(t)}),["pattern","modifiers"]),integer:a((function(t){return!l(t)||t==parseInt(t)})),number:a((function(t){return!l(t)||t==parseFloat(t)})),array_min_length:g,array_max_length:m};function _(t){if("object"==typeof t)return t;if("string"!=typeof t)throw"Validation rules definition should be a string";const e=t.split(" | ");let n={};return e.forEach((function(t){let e=function(t){if(-1===t.indexOf("("))return{name:t,params:[]};if(!t.endsWith(")"))throw'Rule expression is not correct. Good expression: "between(3,5)"';let e=t.indexOf("("),n=[t.substring(0,e),t.substring(e+1,t.length-1)];return{name:n[0],params:n[1]?JSON.parse("["+n[1]+"]"):""}}(t);if(!y[e.name])throw"Rule named "+e.name+" is not registered";n[e.name]=y[e.name].apply(null,e.params)})),n}function v(t,e,n){let r=e.replace(/\]/g,"").split("["),i=t;return r.map((function(t,e){if(e!==r.length-1){if(!i[t]){let n=r[e+1];i[t]=n==parseInt(n)?[]:{}}i=i[t]}else i[t]=n})),t}function x(t,e){if(-1===e.indexOf("*"))return t===e;let n=new RegExp(e.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace("*","([^\\]]+)"));return!!t.match(n)}function T(t){return t&&(Array.isArray(t)||"object"==typeof t&&Object.keys(t).length>0)}function w(t,e){let n={};return T(t)&&i(t,(function(t,r){let i=e?e+"["+t+"]":t;n[i]=r,T(r)&&Object.assign(n,w(r,i))})),n}function O(t){let e={};return i(t,(function(t,n){i(n,(function(n,r){r.refs&&r.refs.length&&r.refs.forEach((function(n){e[n]=e[n]||[],e[n].push(t)}))}))})),e}return{messages:t,rules:y,rule(e,n,r){y[e]=n,t[e]=r},utils:{get:n,set:v,getReferencePath:e,pathMatchesSelector:x},make:function(r,a,l,u,o){let h={},f={},c={},d={},g={},m={};l=l||console.log,o=s||o,u=Object.assign({},t,u);let p={$rules:{},getData:()=>m,setData(t,e,n){n&&i(t,(function(t){delete m[t]})),i(t,((t,n)=>{this.set(t,n,e)}))},get:t=>n(m,t),set(t,n,r){let i=this.get(t);v(m,t,n),this.setTouched(t),i!==n&&(this.setDirty(t),r||this.validateItem(t)),!r&&g[t]&&g[t].forEach((n=>{let r=e(t,n);this.isTouched(r)&&this.validateItem(r)}))},addRules(t,e){"object"==typeof t?i(t,((t,e)=>{this.$rules[t]=_(e)})):this.$rules[t]=_(e),g=O(this.$rules)},removeRules(t,e){this.$rules[t]&&(Array.isArray(e)||(e=[e]),e.forEach((e=>{this.$rules[t][e]&&delete this.$rules[t][e]})),g=O(this.$rules))},setTouched(t){h[t]=!0},isTouched:t=>!!h[t],resetTouched(){h={}},setDirty(t){f[t]=!0},isDirty:t=>!!f[t],resetDirty(){f={}},setError(t,e){d[t]=e,function(t){"function"==typeof a&&a.call(p,"validation",t)}(t)},hasError:t=>t?!!d[t]:Object.values(d).filter((t=>!!t)).length>0,getError:t=>d[t],setPending(t,e){c[t]=!!e,function(t){"function"==typeof a&&a.call(p,"state",t)}(t)},isPending:t=>t?c[t]:!!Object.values(c).find((t=>!!t)),isValid(){return!this.hasError()},validateItem(t){let e=function(t,e){let n=Object.keys(e).filter((function(e){return x(t,e)}));if(0==n.length)return!1;n.sort((function(t,e){let n=-(t.match(/\*/gi)||[]).length,r=-(e.match(/\*/gi)||[]).length;return n<r?-1:n>r?1:0}));var r=[];return n.forEach((function(t){i(e[t],(function(e,n){r.find((function(t){return t.name==e}))||r.push({selector:t,name:e,validator:n})}))})),r}(t,this.$rules),n=this.get(t);if(T(n)&&(i(d,(e=>{e!==t&&e.substring(0,t.length)===t&&delete d[e]})),i(n,(e=>{this.validateItem(t+"["+e+"]")}))),e&&0!==e.length)try{let i=null;for(var r=0,s=e.length;r<s;r++){let s=e[r];if(!s.validator||!s.validator.validate)continue;let a=s.validator.validate(n,t,m);if(!1===a){i=o(this,t,s.selector,s.name,u);break}if(a.then){this.setPending(t,!0),a.then((e=>{!1===e?this.setError(t,o(this,t,s.selector,s.name,u)):this.setError(t,null),this.setPending(t,!1)})).catch((function(t){l.call(this,"field_validation",t)}));break}}this.setError(t,i)}catch(t){l.call(this,"field_validation",t)}else this.setError(t,null)},validate(){var t;return t=m,Object.keys(this.$rules).forEach((e=>{let n=e.indexOf("[");-1!==n&&(e=e.substring(0,n)),t.hasOwnProperty(e)||(t[e]=null)})),Object.keys(w(m)).forEach((t=>{d.hasOwnProperty(t)||(this.validateItem(t),this.setTouched(t),this.setDirty(t))})),this.isPending()?new Promise((t=>{let e=new Date,n=setInterval((()=>{new Date-e>5e3?(clearInterval(n),l.call(this,"promise",new Error("Data validation has timed out"))):this.isPending()||t(this.isValid())}),100)})):Promise.resolve(this.isValid())},reset(){this.resetTouched(),this.resetDirty(),c={},d={}}};return r&&p.addRules(r),p}}}));
